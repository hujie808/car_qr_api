<script type="text/html" id="barTable">
    <a class="layui-btn layui-btn-xs" lay-event="edit">ç¼–è¾‘</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">åˆ é™¤</a>
</script>
<script type="text/html" id="img_tmpl">
    <img src="" style="width: 100px;height: 100px;"/>
</script>
<script>
    layui.use('table', function () {
        var table = layui.table;
        table.render({
            elem: '#table',
            url: '{{ urlfor "Index.GetIndex"}}',
            cellMinWidth: 80,//å…¨å±€å®šä¹‰å¸¸è§„å•å…ƒæ ¼çš„æœ€å°å®½åº¦ï¼Œlayui 2.2.1 æ–°å¢
            method: "post",
            where: {Id: "1", user_id: "1"},
            cols: [
                [{
                    field: 'ad_all_count',
                    minWidth: 80,
                    title: 'å¹¿å‘Šæ€»æ•°'
                }, {
                    field: 'ad_count',
                    minWidth: 80,
                    title: 'å¯è®¾ç½®æœ€å¤§æ•°é‡'
                }, {
                    field: 'default_ad_list',
                    minWidth: 80,
                    title: 'é»˜è®¤å¹¿å‘Šid'
                }, {
                    field: 'expire_date',
                    minWidth: 80,
                    title: 'è´¦å·è¿‡æœŸæ—¶é—´'
                }, {
                    field: 'qr_inuse_count',
                    title: 'æ­£åœ¨ä½¿ç”¨äºŒç»´ç ',
                    minWidth: 100
                }
                ]
            ],
            response: {
                // statusCode: 200
            },
            parseData: function (res) {
                console.log(res.data);
                return {
                    "data": [res.data],
                    "code": res.code
                }
            }
        });
        table.render({
            elem: '#table_list',
            url: '{{ urlfor "Index.GetIndex"}}',//å…¨å±€å®šä¹‰å¸¸è§„å•å…ƒæ ¼çš„æœ€å°å®½åº¦ï¼Œlayui 2.2.1 æ–°å¢
            method: "post",
            where: {Id: "1", user_id: "1"},
            cols: [
                [{
                    field: 'Id',
                    minWidth: 15,
                    title: 'Id',
                    fixed: 'left',

                }, {
                    field: 'Content',
                    minWidth: 80,
                    title: 'å¹¿å‘Šå†…å®¹'
                }, {
                    field: 'DefualtFlag',
                    minWidth: 15,
                    title: 'é»˜è®¤å¹¿å‘Š'
                }, {
                    field: 'Pic',
                    title: 'å¹¿å‘Šå›¾ç‰‡',
                    minWidth: 200,
                    // templet: "#img_tmpl"
                } //minWidthï¼šå±€éƒ¨å®šä¹‰å½“å‰å•å…ƒæ ¼çš„æœ€å°å®½åº¦ï¼Œlayui 2.2.1 æ–°å¢
                    , {
                    field: "Url",
                    title: 'è·³è½¬è·¯å¾„',
                    minWidth: 100
                }, {
                    field: 'UpdateDate',
                    title: 'æ›´æ–°æ—¶é—´',
                    minWidth: 100
                }, {fixed: 'right', width: 165, align: 'center', toolbar: '#barTable'}

                ]
            ],
            response: {
                // statusCode: 200
            },
            parseData: function (res) {
                console.log(res.data);
                for (let i = 0; i < res.data.ad_all.length; i++) {
                    // res.data.ad_all[i].Pic = res.data.ad_all[i].Pic
                    res.data.ad_all[i].Pic = '<div><img style="width: 100px;height: 100px;" src=\"' + res.data.ad_all[i].Pic + '\"></div>';

                    if (res.data.ad_all[i].DefualtFlag == "1") {
                        res.data.ad_all[i].DefualtFlag = "ğŸ”´ï¸"
                    } else {
                        res.data.ad_all[i].DefualtFlag = "â­•"
                    }
                }
                return {

                    "data": res.data.ad_all,
                    "code": res.code
                }
            }
        });
        //ç›‘å¬å¤´å·¥å…·æ äº‹ä»¶
        table.on('tool(ad)', function (obj) { //æ³¨ï¼štool æ˜¯å·¥å…·æ¡äº‹ä»¶åï¼Œtest æ˜¯ table åŸå§‹å®¹å™¨çš„å±æ€§ lay-filter="å¯¹åº”çš„å€¼"
            var data = obj.data //è·å¾—å½“å‰è¡Œæ•°æ®
                , layEvent = obj.event; //è·å¾— lay-event å¯¹åº”çš„å€¼
            if (layEvent === 'detail') {
                layer.msg('æŸ¥çœ‹æ“ä½œ');
            } else if (layEvent === 'del') {
                layer.confirm('çœŸçš„åˆ é™¤è¡Œä¹ˆ', function (index) {
                    obj.del(); //åˆ é™¤å¯¹åº”è¡Œï¼ˆtrï¼‰çš„DOMç»“æ„
                    layer.close(index);
                    //å‘æœåŠ¡ç«¯å‘é€åˆ é™¤æŒ‡ä»¤
                    $.ajax({
                        type: 'delete',
                        url: '{{ urlfor "Index.GetListAdd"}}' + '/' + data.Id, // ajaxè¯·æ±‚è·¯å¾„
                        data: {},
                        success: function (data) {
                            if (data == 'ok') {
                                layer.msg('åˆ é™¤æˆåŠŸ');
                            } else if (data == 'error') {
                                layer.msg('åˆ é™¤å¤±è´¥');
                            }
                        },
                        error: function (rep) {
                            layer.msg("å¤±è´¥:" + rep.responseJSON.msg);
                        }
                    });

                });
            } else if (layEvent === 'edit') {
                console.log('{{urlfor "Index.GetListAdd"}}')
                window.location.href = '{{urlfor "Index.GetListAdd"}}' + '/' + data.Id
                layer.msg('ç¼–è¾‘æ“ä½œ1');
            }
        });

    });

</script>